<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜è€ƒå†å²åŸºç¡€çŸ¥è¯† - å¤ªç©ºå°„å‡»æŒ‘æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            cursor: none;
        }
        
        #gameCanvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #gameUI {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            pointer-events: none;
            z-index: 10;
        }
        
        #question {
            font-size: 28px;
            text-align: center;
            color: #FFD700;
            text-shadow: 0 0 20px #FFD700, 0 0 40px #FFD700;
            margin-bottom: 20px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        #stats {
            display: flex;
            justify-content: space-around;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .stat-item {
            background: linear-gradient(135deg, rgba(0,100,255,0.3), rgba(0,200,255,0.2));
            padding: 12px 25px;
            border-radius: 30px;
            border: 2px solid rgba(0,200,255,0.6);
            backdrop-filter: blur(10px);
            font-size: 18px;
            box-shadow: 0 0 20px rgba(0,200,255,0.4);
            animation: statPulse 2s ease-in-out infinite;
        }
        
        @keyframes statPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        #crosshair {
            position: fixed;
            width: 50px;
            height: 50px;
            pointer-events: none;
            z-index: 1000;
            transform: translate(-50%, -50%);
        }
        
        #startScreen, #endScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, rgba(0,0,80,0.95), rgba(0,0,0,1));
            z-index: 100;
        }
        
        #endScreen {
            display: none;
        }
        
        .game-title {
            font-size: 56px;
            color: #FFD700;
            text-shadow: 0 0 30px #FFD700, 0 0 60px #FFA500;
            margin-bottom: 30px;
            animation: titleFloat 3s ease-in-out infinite;
            letter-spacing: 3px;
        }
        
        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .btn {
            padding: 18px 50px;
            font-size: 22px;
            background: linear-gradient(135deg, #1E90FF, #00BFFF, #4169E1);
            background-size: 200% 200%;
            animation: btnGradient 3s ease infinite;
            border: none;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 25px rgba(30,144,255,0.5);
            position: relative;
            overflow: hidden;
        }
        
        @keyframes btnGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 35px rgba(30,144,255,0.7);
        }
        
        .btn:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        #wrongAnswers {
            margin-top: 20px;
            max-width: 900px;
            max-height: 350px;
            overflow-y: auto;
            background: rgba(0,0,0,0.6);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(255,215,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .wrong-item {
            background: linear-gradient(to right, rgba(255,0,0,0.15), rgba(255,0,0,0.05));
            padding: 15px 20px;
            margin: 12px 0;
            border-radius: 10px;
            border-left: 5px solid #FF4444;
            font-size: 17px;
            transition: all 0.3s;
        }
        
        .wrong-item:hover {
            background: linear-gradient(to right, rgba(255,0,0,0.25), rgba(255,0,0,0.15));
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(255,0,0,0.2);
        }
        
        .combo-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            color: #FFD700;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 0 0 50px #FFD700, 0 0 100px #FFA500;
            animation: comboAnim 1s ease-out forwards;
            z-index: 50;
        }
        
        @keyframes comboAnim {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-360deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(360deg);
                opacity: 0;
            }
        }
        
        #soundToggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #FFD700;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            z-index: 101;
        }
        
        #soundToggle:hover {
            background: rgba(255,215,0,0.2);
        }
        
        @keyframes encourageAnim {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(2) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5) rotate(180deg) translateY(-50px);
                opacity: 0;
            }
        }
        
        @keyframes correctAnswerAnim {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="crosshair">
        <svg width="50" height="50">
            <circle cx="25" cy="25" r="20" fill="none" stroke="#FFD700" stroke-width="2" opacity="0.8"/>
            <circle cx="25" cy="25" r="3" fill="#FFD700"/>
            <line x1="25" y1="5" x2="25" y2="15" stroke="#FFD700" stroke-width="2"/>
            <line x1="25" y1="35" x2="25" y2="45" stroke="#FFD700" stroke-width="2"/>
            <line x1="5" y1="25" x2="15" y2="25" stroke="#FFD700" stroke-width="2"/>
            <line x1="35" y1="25" x2="45" y2="25" stroke="#FFD700" stroke-width="2"/>
        </svg>
    </div>
    
    <div id="soundToggle" onclick="toggleSound()">ğŸ”Š</div>
    
    <div id="gameUI" style="display: none;">
        <div id="question"></div>
        <div id="stats">
            <div class="stat-item">ğŸ¯ å¾—åˆ†: <span id="score">0</span>/100</div>
            <div class="stat-item">ğŸ“ ç¬¬ <span id="current">1</span>/10 é¢˜</div>
            <div class="stat-item">ğŸ”¥ è¿å‡»: <span id="combo">0</span></div>
            <div class="stat-item">â¤ï¸ ç”Ÿå‘½: <span id="lives">3</span></div>
        </div>
    </div>
    
    <div id="startScreen">
        <h1 class="game-title">ğŸš€ é«˜è€ƒå†å²åŸºç¡€çŸ¥è¯† ğŸš€</h1>
        <p style="font-size: 24px; margin-bottom: 10px; color: #00BFFF;">å¤ªç©ºå°„å‡»æŒ‘æˆ˜</p>
        <p style="font-size: 18px; margin-bottom: 30px; color: #87CEEB;">é©¾é©¶æ­¼-20æˆ˜æœºï¼Œå°„å‡»æ­£ç¡®çš„å†å²ç­”æ¡ˆï¼</p>
        <button class="btn" onclick="startGame()">ğŸ® å¼€å§‹æŒ‘æˆ˜</button>
        <button class="btn" onclick="toggleLeaderboard()">ğŸ† è‹±é›„æ’è¡Œæ¦œ</button>
        <div style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); text-align: center;">
            <p style="font-size: 16px; color: #FFD700; margin-bottom: 5px;">å¼€å‘è€…ï¼šä¼Šåˆ©ä¸¹</p>
            <p style="font-size: 14px; color: #87CEEB;">Â© 2024 é«˜è€ƒå†å²å­¦ä¹ æ¸¸æˆ</p>
        </div>
        <div id="leaderboard" style="display: none;">
            <h3 style="text-align: center; color: #FFD700; font-size: 24px; margin-bottom: 15px;">ğŸ† å†å²çŸ¥è¯†è‹±é›„æ¦œ ğŸ†</h3>
            <div id="leaderboardList"></div>
        </div>
    </div>
    
    <div id="endScreen">
        <h1 class="game-title" style="font-size: 48px; margin-bottom: 30px;">ğŸ¯ æŒ‘æˆ˜ç»“æŸ ğŸ¯</h1>
        
        <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 30px;">
            <div style="text-align: center;">
                <p style="font-size: 20px; color: #87CEEB; margin-bottom: 10px;">æœ€ç»ˆå¾—åˆ†</p>
                <p style="font-size: 56px; color: #FFD700; font-weight: bold;"><span id="finalScore">0</span>/100</p>
            </div>
            <div style="text-align: center;">
                <p style="font-size: 20px; color: #87CEEB; margin-bottom: 10px;">æ­£ç¡®ç‡</p>
                <p style="font-size: 56px; color: #00BFFF; font-weight: bold;"><span id="accuracy">0</span>%</p>
            </div>
            <div style="text-align: center;">
                <p style="font-size: 20px; color: #87CEEB; margin-bottom: 10px;">æœ€é«˜è¿å‡»</p>
                <p style="font-size: 56px; color: #FF6B35; font-weight: bold;"><span id="maxCombo">0</span></p>
            </div>
        </div>
        
        <div class="grade-display" id="gradeDisplay" style="font-size: 36px; margin-bottom: 30px;"></div>
        
        <button class="btn" onclick="restartGame()" style="font-size: 24px; padding: 20px 60px; margin-bottom: 30px;">ğŸ”„ å†æˆ˜ä¸€æ¬¡</button>
        
        <div id="wrongAnswers" style="max-height: 350px; width: 90%; max-width: 900px;"></div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const crosshair = document.getElementById('crosshair');
        
        // éŸ³é¢‘ä¸Šä¸‹æ–‡
        let audioContext = null;
        let soundEnabled = true;
        
        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            if (!soundEnabled || !audioContext) return;
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.connect(gain);
            gain.connect(audioContext.destination);
            
            switch(type) {
                case 'shoot':
                    osc.frequency.value = 800;
                    osc.type = 'square';
                    gain.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.1);
                    break;
                    
                case 'hit':
                    osc.frequency.value = 400;
                    osc.type = 'sine';
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.3);
                    break;
                    
                case 'correct':
                    for (let i = 0; i < 3; i++) {
                        const o = audioContext.createOscillator();
                        const g = audioContext.createGain();
                        o.connect(g);
                        g.connect(audioContext.destination);
                        o.frequency.value = 523.25 * Math.pow(2, i/4);
                        o.type = 'sine';
                        g.gain.setValueAtTime(0.1, audioContext.currentTime + i * 0.1);
                        g.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.2);
                        o.start(audioContext.currentTime + i * 0.1);
                        o.stop(audioContext.currentTime + i * 0.1 + 0.2);
                    }
                    break;
                    
                case 'wrong':
                    osc.frequency.value = 200;
                    osc.type = 'sawtooth';
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.5);
                    break;
            }
        }
        
        // åˆ‡æ¢éŸ³æ•ˆ
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        }
        
        // è®¾ç½®ç”»å¸ƒå¤§å°
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // æ¸¸æˆå˜é‡
        let gameState = 'menu';
        let score = 0;
        let currentQuestion = 0;
        let lives = 3;
        let combo = 0;
        let maxCombo = 0;
        let questions = [];
        let currentQuestionData = null;
        let targets = [];
        let bullets = [];
        let particles = [];
        let stars = [];
        let wrongAnswers = [];
        let correctCount = 0;
        let mouseX = 0;
        let mouseY = 0;
        let currentQuestionAnswered = false;
        let lastHitTarget = null;
        
        // é£æœº
        let plane = {
            x: canvas.width / 2,
            y: canvas.height - 150,
            targetX: canvas.width / 2,
            angle: 0,
            speed: 0.2
        };
        
        // å®Œæ•´é¢˜åº“
        const questionBank =[
{ question: "å½“å‰å®˜æ–¹è§‚ç‚¹æ˜¯ï¼šä¸­å›½æœ‰_____å¹´çš„æ–‡æ˜å²", correctAnswer: "5åƒ", wrongAnswers: ["100ä¸‡å¹´", "1ä¸‡å¹´", "3åƒå¹´"] },
{ question: "ç§‘ä¸¾åˆ¶åºŸé™¤äº_____æ—¶æœŸ", correctAnswer: "æ¸…æœ«æ–°æ”¿", wrongAnswers: ["ä¸­åæ°‘å›½ä¸´æ—¶æ”¿åºœ", "æ–°æ–‡åŒ–è¿åŠ¨", "æˆŠæˆŒå˜æ³•"] },
{ question: "ç§‘ä¸¾åˆ¶æ­£å¼åºŸé™¤äº_____å¹´", correctAnswer: "1905", wrongAnswers: ["1911", "1912", "1901"] },
{ question: "å½“å‰å®˜æ–¹è§‚ç‚¹æ˜¯ï¼š_____æ–‡åŒ–ï¼Œå®è¯ä¸­åæ–‡æ˜äº”åƒå¹´", correctAnswer: "è‰¯æ¸š", wrongAnswers: ["é™¶å¯º", "çº¢å±±", "ä»°éŸ¶"] },
{ question: "æˆ˜å›½åˆæœŸï¼Œå¯¹å„’å®¶æ„æˆå·¨å¤§å‹åŠ›çš„æ˜¯_____ã€‚", correctAnswer: "å¢¨å®¶ä¸æ¨æœ±å­¦æ´¾", wrongAnswers: ["æ³•å®¶ä¸é“å®¶", "ä½›æ•™ä¸é“æ•™", "å®—æ•™ç¥å­¦è§‚"] },
{ question: "å°å†œç»æµäº§ç”Ÿäº_____æ—¶æœŸã€‚", correctAnswer: "æ˜¥ç§‹æˆ˜å›½", wrongAnswers: ["æ–°çŸ³å™¨æ—¶ä»£åˆæœŸ", "è¥¿å‘¨", "é­æ™‹åº„å›­ç»æµ"] },
{ question: "å„’å­¦åœ¨æ±‰ä»£å¼€å§‹äº†_____åŒ–ã€‚", correctAnswer: "ç¥å­¦", wrongAnswers: ["ä¼¦ç†å­¦", "å“²å­¦", "ç§‘å­¦"] },
{ question: "å„’å­¦åœ¨_____æ—¶æœŸå®Œæˆäº†å“²å­¦åŒ–ã€‚", correctAnswer: "å®‹æ˜", wrongAnswers: ["æˆ˜å›½", "æ±‰ä»£", "æ˜æ¸…"] },
{ question: "æ–°ç–†åœ¨_____æ—¶æœŸæ­£å¼çº³å…¥ä¸­å›½ç‰ˆå›¾ã€‚", correctAnswer: "è¥¿æ±‰", wrongAnswers: ["ç§¦æœ", "å”æœ", "å…ƒæœ"] },
{ question: "è¥¿è—åœ¨_____æ—¶æœŸæ­£å¼çº³å…¥ä¸­å›½ç‰ˆå›¾ã€‚", correctAnswer: "å…ƒæœ", wrongAnswers: ["æ±‰æœ", "å”æœ", "æ˜æœ"] },
{ question: "åº·ç†™æ—¶æœŸï¼Œæ¸…æ”¿åºœåœ¨å°æ¹¾è®¾____ï¼Œéš¶å±ç¦å»ºçœ", correctAnswer: "åºœ", wrongAnswers: ["å¿", "å·", "çœ"] },
{ question: "_____æˆ˜äº‰åï¼Œæ¸…æ”¿åºœåœ¨å°æ¹¾æ­£å¼è®¾çœã€‚", correctAnswer: "ä¸­æ³•", wrongAnswers: ["é¸¦ç‰‡", "ç”²åˆä¸­æ—¥", "å…«å›½è”å†›ä¾µå"] },
{ question: "ç§è¥æ‰‹å·¥ä¸šè¶…è¿‡å®˜è¥å¼€å§‹äº_____", correctAnswer: "æ˜æœä¸­åæœŸ", wrongAnswers: ["æ˜¥ç§‹æˆ˜å›½", "å®‹å…ƒæ—¶æœŸ", "é¸¦ç‰‡æˆ˜äº‰å"] },
{ question: "æ±‰å­—ã€ç»˜ç”»çš„è‰ºæœ¯åŒ–å¼€å§‹äº____æ—¶æœŸ", correctAnswer: "é­æ™‹", wrongAnswers: ["é™¶å¯º", "æ˜¥ç§‹æˆ˜å›½", "å”"] },
{ question: "â€œåå¤è®¤åŒâ€è§‚å¿µå¼€å§‹äº____æ—¶æœŸ", correctAnswer: "ä¸œå‘¨", wrongAnswers: ["æ–°çŸ³å™¨æ—¶ä»£", "è¥¿å‘¨", "ç§¦æ±‰"] },
{ question: "ç§Ÿåº¸è°ƒåˆ¶ä»____å¼€å§‹å®è¡Œ", correctAnswer: "å”æœ", wrongAnswers: ["æ±‰", "åŒ—é­", "æ¸…"] },
{ question: "ç‡å…ˆåœ¨å…¨å›½é€šè¡Œçº¸å¸çš„æ˜¯___", correctAnswer: "å…ƒä»£", wrongAnswers: ["æ±‰æ­¦å¸ä»¥å", "å®‹ä»£", "æ˜ä»£"] },
{ question: "è®¾ç«‹å†…é˜å¤§å­¦å£«çš„æ˜¯____", correctAnswer: "æ˜æˆç¥–", wrongAnswers: ["æ˜å¤ªç¥–", "æ˜å®ªå®—", "ä¸‡å†å¸"] },
{ question: "_____ï¼Œç»æµé‡å¿ƒå¼€å§‹å—ç§»ã€‚", correctAnswer: "å®‰å²ä¹‹ä¹±å", wrongAnswers: ["é­æ™‹å—åŒ—æœ", "ä¸¤å®‹æ—¶æœŸ", "æ˜ä¸­åæœŸ"] },
{ question: "æ˜æœèµ·æ­¢æ—¶é—´æ˜¯____å¹´", correctAnswer: "1368--1644", wrongAnswers: ["960--1279", "1566--1644", "1644-1765"] },
{ question: "ä¸­å›½è‡ªç„¶ç»æµå¼€å§‹è§£ä½“äº_____", correctAnswer: "é¸¦ç‰‡æˆ˜äº‰å", wrongAnswers: ["æ™šæ˜æ—¶æœŸ", "ç”²åˆæˆ˜å", "æ–°ä¸­å›½æˆç«‹"] },
{ question: "ä¸ä¸­å›½åŒç›Ÿä¼šäº§ç”ŸåŒä¸€å¹´çš„æ˜¯____", correctAnswer: "äº”å¤§è‡£å‡ºæ´‹è€ƒå¯Ÿå®ªæ”¿", wrongAnswers: ["ç”²åˆä¸­æ—¥æˆ˜äº‰", "ã€Šè¾›ä¸‘æ¡çº¦ã€‹ç­¾è®¢", "â€œçš‡æ—å†…é˜â€äº§ç”Ÿ"] },
{ question: "ä¸â€œçš‡æ—å†…é˜â€åŒä¸€å¹´å‡ºç°çš„æ˜¯____", correctAnswer: "æ­¦æ˜Œèµ·ä¹‰", wrongAnswers: ["ã€Šè¾›ä¸‘æ¡çº¦ã€‹ç­¾è®¢", "ã€Šé’¦å®šå®ªæ³•å¤§çº²ã€‹é¢å¸ƒ", "å…‰ç»ªå’Œæ…ˆç¦§å»ä¸–"] },
{ question: "ä¸œå—äº’ä¿ä¸____åŒæ—¶", correctAnswer: "ä¹‰å’Œå›¢è¿åŠ¨", wrongAnswers: ["å¤ªå¹³å¤©å›½è¿åŠ¨", "æ´‹åŠ¡è¿åŠ¨", "è¾›äº¥é©å‘½"] },
{ question: "åˆ—å®é€ä¸–åŒä¸€å¹´å‘ç”Ÿçš„æ˜¯____", correctAnswer: "å›½æ°‘å…šä¸€å¤§å¬å¼€", wrongAnswers: ["äº”å››è¿åŠ¨", "åŒ—ä¼å¼€å§‹", "å—æ˜Œèµ·ä¹‰"] },
{ question: "ä¸å›½æ°‘å…šå½¢å¼ä¸Šç»Ÿä¸€å…¨å›½åœ¨åŒä¸€å¹´çš„æ˜¯____", correctAnswer: "äº•å†ˆå±±ä¼šå¸ˆ", wrongAnswers: ["å—æ˜Œèµ·ä¹‰", "äº•å†ˆå±±æ ¹æ®åœ°å¼€å§‹å»ºç«‹", "ä¸­åŸå¤§æˆ˜"] },
{ question: "ç”²åˆæˆ˜å____å¹´ï¼Œæ—¥ä¿„æˆ˜äº‰çˆ†å‘ã€‚", correctAnswer: "å", wrongAnswers: ["ä¸¤å¹´", "äº”å¹´", "äºŒåå¹´"] },
{ question: "å›½æ°‘å…šæ”¿åºœæ¨è¡Œæ³•å¸æ”¿ç­–æ˜¯åœ¨____å¹´", correctAnswer: "1935", wrongAnswers: ["1933", "1937", "1948"] },
{ question: "å›½æ°‘å…šæ”¿åºœâ€œè®­æ”¿â€é˜¶æ®µçš„æ—¶é—´æ˜¯____å¹´æœŸé—´ã€‚", correctAnswer: "1928--1948", wrongAnswers: ["1912--1927", "1927--1937", "1937--1945"] },
{ question: "æ¸…æœå¯¹å¤–è´¸æ˜“ç¬¬ä¸€æ¬¡å‡ºç°å…¥è¶…æ˜¯åœ¨____å¹´ã€‚", correctAnswer: "1865", wrongAnswers: ["1842", "1895", "1901"] },
{ question: "ã€Šèµ„æ”¿æ–°ç¯‡ã€‹é¢å¸ƒçš„åŒä¸€å¹´ï¼Œ_____å‘è¡¨ã€‚", correctAnswer: "ã€Šç‰©ç§èµ·æºã€‹", wrongAnswers: ["â€œæ—¥å¿ƒè¯´â€", "ã€Šå¤©æœç”°äº©åˆ¶åº¦ã€‹", "ä¸‰æ°‘ä¸»ä¹‰"] },
{ question: "å¤ªå¹³å¤©å›½è¿åŠ¨çš„èµ·æ­¢æ—¶é—´æ˜¯____å¹´ã€‚", correctAnswer: "1851--1864", wrongAnswers: ["1856--1860", "1861--1895", "1860--1885"] },
{ question: "ã€Šå¤©æœç”°äº©åˆ¶åº¦ã€‹é¢å¸ƒ100å‘¨å¹´æ—¶ï¼Œä¸­å›½å¼€å§‹è¿›è¡Œ_____ã€‚", correctAnswer: "å†œä¸šåˆä½œåŒ–", wrongAnswers: ["åœŸåœ°æ”¹é©è¿åŠ¨", "äººæ°‘å…¬ç¤¾åŒ–", "å®¶åº­è”äº§æ‰¿åŒ…è´£ä»»åˆ¶"] },
{ question: "ä¸å±äºä¸­å›½19ä¸–çºª70å¹´ä»£å‡ºç°çš„æ˜¯____ã€‚", correctAnswer: "ä¸­æ³•æˆ˜äº‰", wrongAnswers: ["æ°‘æ—èµ„æœ¬ä¸»ä¹‰äº§ç”Ÿ", "æ´‹åŠ¡æ´¾æ°‘ç”¨å·¥ä¸šå¼€å§‹", "è¾¹ç–†å±æœº"] },
{ question: "å±äºä¸­å›½19ä¸–çºª40å¹´ä»£å‡ºç°çš„æ˜¯____ã€‚", correctAnswer: "äº”å£é€šå•†", wrongAnswers: ["æ´‹åŠ¡è¿åŠ¨", "ç«çƒ§åœ†æ˜å›­", "å¤ªå¹³å¤©å›½è¿åŠ¨"] },
{ question: "å±äºä¸­å›½19ä¸–çºª50å¹´ä»£å‡ºç°çš„æ˜¯____ã€‚", correctAnswer: "å†œæ°‘è¿åŠ¨è¾¾åˆ°äº†æœ€é«˜å³°", wrongAnswers: ["è¿‘ä»£å·¥ä¸šåŒ–å¼€å§‹", "è¾¹ç–†å±æœº", "å®‰åº†å†…å†›æ¢°æ‰€"] },
{ question: "ç”²åˆä¸­æ—¥æˆ˜äº‰å‘ç”Ÿåœ¨____å¹´ã€‚", correctAnswer: "1894--1895", wrongAnswers: ["1883--1885", "1898", "1900--1901"] },
{ question: "åˆ—å¼ºå¯¹åèµ„æœ¬è¾“å‡ºä¸ºä¸»çš„æ—¶é—´æ˜¯____ä»¥åã€‚", correctAnswer: "ç”²åˆæˆ˜äº‰", wrongAnswers: ["é¸¦ç‰‡æˆ˜äº‰", "å¤ªå¹³å¤©å›½è¿åŠ¨", "ã€Šè¾›ä¸‘æ¡çº¦ã€‹ç­¾è®¢"] },
{ question: "åˆ—å¼ºç“œåˆ†ä¸­å›½çš„ç‹‚æ½®å¼€å§‹äº____å¹´ã€‚", correctAnswer: "1897", wrongAnswers: ["1860", "1898", "1901"] },
{ question: "æ¸…æ”¿åºœå®£å¸ƒâ€œé¢„å¤‡ç«‹å®ªâ€å¼€å§‹äº____å¹´ã€‚", correctAnswer: "1906", wrongAnswers: ["1901", "1905", "1908"] },
{ question: "ä¸å±äº1908å¹´å‘ç”Ÿçš„æ˜¯____ã€‚", correctAnswer: "â€œçš‡æ—å†…é˜â€å‡ºå°", wrongAnswers: ["æ…ˆç¦§å»ä¸–", "ã€Šé’¦å®šå®ªæ³•å¤§çº²ã€‹", "å…‰ç»ªå»ä¸–"] },
{ question: "å±äº1912å¹´1æœˆä»½çš„æ˜¯____ã€‚", correctAnswer: "æ°‘å›½å»ºç«‹", wrongAnswers: ["æ¸…æœç­äº¡", "åŒ—æ´‹æ”¿åºœæˆç«‹", "ã€Šä¸´æ—¶çº¦æ³•ã€‹é¢å¸ƒ"] },
{ question: "ä¸¤ç¨æ³•äº§ç”Ÿçš„èƒŒæ™¯æ˜¯____ã€‚", correctAnswer: "å®‰å²ä¹‹ä¹±ä»¥å", wrongAnswers: ["è´è§‚å¹´é—´", "å¼€å…ƒç››ä¸–", "å‡ç”°åˆ¶ç››è¡Œ"] },
{ question: "è®¾ç½®é©»è—å¤§è‡£çš„æœä»£æ˜¯____æœã€‚", correctAnswer: "æ¸…", wrongAnswers: ["æ±‰", "å”", "å…ƒ"] },
{ question: "è®¾ç½®åä¸‰è¡Œå¯¹å¤–è´¸æ˜“æœºæ„çš„æ˜¯____æœã€‚", correctAnswer: "æ¸…", wrongAnswers: ["å”", "å®‹", "å…ƒ"] },
{ question: "ä¸¤æ¡ä¸ç»¸ä¹‹è·¯æœ€æ—©å¼€é€šäº____æœã€‚", correctAnswer: "æ±‰", wrongAnswers: ["ç§¦", "å”", "å…ƒ"] },
{ question: "ä¸å±äºæ±‰æ­¦å¸æ—¶æœŸçš„æ˜¯å®è¡Œ____æ”¿ç­–ã€‚", correctAnswer: "å‰Šè—©", wrongAnswers: ["äº”ç»åšå£«", "ä¸­æœåˆ¶", "ç›é“å®˜è¥"] },
{ question: "ä¸‹åˆ—å±äºæ±‰æ­¦å¸æ—¶æœŸä¸è¥¿åŸŸå…³ç³»çš„æ˜¯____ã€‚", correctAnswer: "å¼ éªé€šè¥¿åŸŸ", wrongAnswers: ["è®¾ç«‹è¥¿åŸŸéƒ½æŠ¤", "è®¾ç«‹å®‰è¥¿éƒ½æŠ¤åºœ", "è®¾ç«‹åŒ—åº­éƒ½æŠ¤åºœ"] },
{ question: "ååŒ—äº”çœä¸å…è®¸ç§‘ä¸¾è€ƒè¯•ï¼Œæœ€æ—©å§‹äº____å¹´ã€‚", correctAnswer: "1901", wrongAnswers: ["1860", "1895", "1912"] },
{ question: "ä¸–ç•Œä¸Šæœ€æ—©ç”±å›½å®¶é¢è¡Œçš„è¯å…¸æ˜¯åœ¨____æœã€‚", correctAnswer: "å”", wrongAnswers: ["æ±‰", "å®‹", "å…ƒ"] },
{ question: "ä¸­å›½ç°å­˜æœ€æ—©çš„ä¸€éƒ¨å®Œæ•´çš„å†œä¹¦äº§ç”Ÿäº____æ—¶æœŸã€‚", correctAnswer: "åŒ—æœ", wrongAnswers: ["æ±‰æœ", "å”æœ", "äº”ä»£"] },
{ question: "â€œå–å£«ä¸é—®å®¶ä¸–ï¼Œå©šå§»ä¸é—®é˜€é˜…â€æ˜¯____ä»£çš„ç°è±¡ã€‚", correctAnswer: "å®‹", wrongAnswers: ["å‘¨", "é­æ™‹", "å”"] },
{ question: "ç†å­¦æˆä¸ºå®˜æ–¹æ­£ç»Ÿæ€æƒ³çš„æ˜¯åœ¨____ã€‚", correctAnswer: "å—å®‹ä»¥å", wrongAnswers: ["åŒ—å®‹ä¸­æœŸ", "å—å®‹ä¸­æœŸ", "æ˜æœåˆæœŸ"] },
{ question: "å€­å¯‡ä¸æ–­å¯¹æˆ‘å›½ä¸œéƒ¨æ²¿æµ·è¿›è¡Œä¾µæ‰°å¼€å§‹äº____ã€‚", correctAnswer: "å…ƒæœæœ«æœŸ", wrongAnswers: ["ä¸¤å®‹ä¹‹é™…", "æ˜æœåˆæœŸ", "æ˜æœä¸­æœŸ"] },
{ question: "ã€Šå°¼å¸ƒæ¥šæ¡çº¦ã€‹ç­¾è®¢åœ¨____å¹´ã€‚", correctAnswer: "1689", wrongAnswers: ["1553", "1662", "1684"] },
{ question: "æ€æƒ³å®¶æè´½æ˜¯____çš„é‡è¦æ€æƒ³å®¶ã€‚", correctAnswer: "æ˜æœä¸­åæœŸ", wrongAnswers: ["æ˜æœä¸­æœŸ", "æ˜æœ«æ¸…åˆ", "æ¸…æœä¸­æœŸ"] },
{ question: "äº¬å‰§å½¢æˆäºæ¸…æœ____æ—¶æœŸã€‚", correctAnswer: "é“å…‰", wrongAnswers: ["åº·ç†™", "ä¹¾éš†", "åŒæ²»"] },
{ question: "é“æ•™å…´èµ·äº____ã€‚", correctAnswer: "ä¸œæ±‰æœ«å¹´", wrongAnswers: ["æ˜¥ç§‹", "æˆ˜å›½", "è¥¿æ±‰æœ«æœŸ"] },
{ question: "å®‰å²ä¹‹ä¹±å‘ç”Ÿçš„æ—¶é—´æ˜¯____ã€‚", correctAnswer: "8ä¸–çºªä¸­æœŸ", wrongAnswers: ["6ä¸–çºªæ™šæœŸ", "7ä¸–çºªåˆæœŸ", "10ä¸–çºªåˆæœŸ"] }
];
        
        // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
        function createStars() {
            stars = [];
            for (let i = 0; i < 200; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 0.5,
                    speed: Math.random() * 0.5 + 0.1,
                    brightness: Math.random()
                });
            }
        }
        
        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            const gradient = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width);
            gradient.addColorStop(0, '#0a0a2e');
            gradient.addColorStop(0.5, '#16213e');
            gradient.addColorStop(1, '#000000');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            stars.forEach(star => {
                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                ctx.fillRect(star.x, star.y, star.size, star.size);
                
                star.y += star.speed;
                if (star.y > canvas.height + 10) {
                    star.y = -10;
                    star.x = Math.random() * canvas.width;
                }
            });
        }
        
        // ç»˜åˆ¶æ­¼-20
        function drawJ20() {
            plane.x += (plane.targetX - plane.x) * plane.speed;
            plane.angle = (plane.targetX - plane.x) * 0.0002;
            
            ctx.save();
            ctx.translate(plane.x, plane.y);
            ctx.rotate(plane.angle);
            
            ctx.shadowColor = 'rgba(0, 200, 255, 0.5)';
            ctx.shadowBlur = 20;
            
            const bodyGradient = ctx.createLinearGradient(0, -50, 0, 50);
            bodyGradient.addColorStop(0, '#4A5568');
            bodyGradient.addColorStop(0.5, '#2D3748');
            bodyGradient.addColorStop(1, '#1A202C');
            
            ctx.fillStyle = bodyGradient;
            ctx.beginPath();
            ctx.moveTo(0, -50);
            ctx.lineTo(-10, -30);
            ctx.lineTo(-15, 0);
            ctx.lineTo(-18, 35);
            ctx.lineTo(-12, 50);
            ctx.lineTo(0, 45);
            ctx.lineTo(12, 50);
            ctx.lineTo(18, 35);
            ctx.lineTo(15, 0);
            ctx.lineTo(10, -30);
            ctx.closePath();
            ctx.fill();
            
            ctx.fillStyle = '#1A202C';
            ctx.beginPath();
            ctx.moveTo(-15, -5);
            ctx.lineTo(-50, 20);
            ctx.lineTo(-45, 40);
            ctx.lineTo(-18, 30);
            ctx.closePath();
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(15, -5);
            ctx.lineTo(50, 20);
            ctx.lineTo(45, 40);
            ctx.lineTo(18, 30);
            ctx.closePath();
            ctx.fill();
            
            ctx.fillStyle = '#2D3748';
            ctx.beginPath();
            ctx.moveTo(-10, -38);
            ctx.lineTo(-30, -25);
            ctx.lineTo(-25, -15);
            ctx.lineTo(-10, -28);
            ctx.closePath();
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(10, -38);
            ctx.lineTo(30, -25);
            ctx.lineTo(25, -15);
            ctx.lineTo(10, -28);
            ctx.closePath();
            ctx.fill();
            
            const cockpitGradient = ctx.createRadialGradient(0, -25, 0, 0, -25, 15);
            cockpitGradient.addColorStop(0, 'rgba(100, 200, 255, 0.9)');
            cockpitGradient.addColorStop(1, 'rgba(50, 150, 200, 0.6)');
            ctx.fillStyle = cockpitGradient;
            ctx.beginPath();
            ctx.ellipse(0, -25, 8, 15, 0, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.shadowColor = 'rgba(255, 100, 0, 0.8)';
            ctx.shadowBlur = 30;
            
            for (let i = -1; i <= 1; i += 2) {
                const flameLength = 30 + Math.random() * 20;
                const flameGradient = ctx.createLinearGradient(i*8, 45, i*8, 45 + flameLength);
                flameGradient.addColorStop(0, 'rgba(255, 200, 100, 0.9)');
                flameGradient.addColorStop(0.5, 'rgba(255, 100, 50, 0.7)');
                flameGradient.addColorStop(1, 'rgba(255, 50, 0, 0)');
                
                ctx.fillStyle = flameGradient;
                ctx.beginPath();
                ctx.moveTo(i*8 - 5, 45);
                ctx.lineTo(i*8 - 3, 50);
                ctx.lineTo(i*8, 45 + flameLength);
                ctx.lineTo(i*8 + 3, 50);
                ctx.lineTo(i*8 + 5, 45);
                ctx.closePath();
                ctx.fill();
            }
            
            ctx.shadowBlur = 0;
            ctx.restore();
        }
        
        // åˆ›å»ºç›®æ ‡
        function createTargets() {
            if (!currentQuestionData) return;
            
            targets = [];
            const answers = [currentQuestionData.correctAnswer];
            const wrongAnswers = [...currentQuestionData.wrongAnswers];
            
            while (wrongAnswers.length < 3) {
                if (currentQuestionData.correctAnswer.includes("å¹´")) {
                    const year = parseInt(currentQuestionData.correctAnswer);
                    if (!isNaN(year)) {
                        wrongAnswers.push((year + wrongAnswers.length + 1) + "å¹´");
                    } else {
                        wrongAnswers.push("å¾…å®š");
                    }
                } else {
                    wrongAnswers.push("å…¶ä»–é€‰é¡¹" + (wrongAnswers.length + 1));
                }
            }
            
            answers.push(...wrongAnswers.slice(0, 3));
            
            for (let i = answers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [answers[i], answers[j]] = [answers[j], answers[i]];
            }
            
            for (let i = 0; i < 4; i++) {
                const shapeData = [];
                const points = 12 + Math.floor(Math.random() * 4);
                for (let j = 0; j < points; j++) {
                    shapeData.push({
                        angle: (j / points) * Math.PI * 2,
                        radiusOffset: Math.random() * 20 - 10
                    });
                }
                
                targets.push({
                    x: (i + 0.5) * (canvas.width / 4),
                    y: -150 - Math.random() * 100,
                    text: answers[i],
                    isCorrect: answers[i] === currentQuestionData.correctAnswer,
                    speed: 1.05 + currentQuestion * 0.1,
                    angle: 0,
                    rotationSpeed: 0,
                    shape: 'asteroid',
                    shapeData: shapeData,
                    size: 80,
                    hit: false,
                    opacity: 1,
                    glowPhase: Math.random() * Math.PI * 2
                });
            }
        }
        
        // ç»˜åˆ¶ç›®æ ‡
        function drawTargets() {
            targets.forEach(target => {
                if (target.hit) return;
                
                ctx.save();
                ctx.translate(target.x, target.y);
                
                const glow = Math.sin(Date.now() * 0.003 + target.glowPhase) * 0.3 + 0.7;
                ctx.shadowColor = 'rgba(100, 150, 255, 0.8)';
                ctx.shadowBlur = 20 * glow;
                
                ctx.fillStyle = '#4A90E2';
                
                ctx.beginPath();
                const baseRadius = target.size / 2;
                
                target.shapeData.forEach((point, i) => {
                    const radius = baseRadius + point.radiusOffset;
                    const x = Math.cos(point.angle) * radius;
                    const y = Math.sin(point.angle) * radius;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.closePath();
                ctx.fill();
                
                ctx.fillStyle = '#60A5FA';
                for (let i = 0; i < 5; i++) {
                    const dotX = (Math.random() - 0.5) * target.size * 0.7;
                    const dotY = (Math.random() - 0.5) * target.size * 0.7;
                    ctx.beginPath();
                    ctx.arc(dotX, dotY, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.shadowBlur = 0;
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(-target.size/2, target.size/2 - 25, target.size, 35);
                
                ctx.strokeStyle = '#60A5FA';
                ctx.lineWidth = 3;
                ctx.strokeRect(-target.size/2, target.size/2 - 25, target.size, 35);
                
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 16px Microsoft YaHei';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(target.text, 0, target.size/2 - 7);
                
                ctx.restore();
                
                target.y += target.speed;
            });
        }
        
        // åˆ›å»ºå­å¼¹
        function shoot() {
            bullets.push({
                x: plane.x,
                y: plane.y - 50,
                vx: 0,
                vy: -15,
                trail: []
            });
            playSound('shoot');
        }
        
        // ç»˜åˆ¶å­å¼¹
        function drawBullets() {
            bullets = bullets.filter(bullet => {
                bullet.y += bullet.vy;
                
                bullet.trail.push({x: bullet.x, y: bullet.y});
                if (bullet.trail.length > 10) bullet.trail.shift();
                
                bullet.trail.forEach((point, i) => {
                    ctx.fillStyle = `rgba(255, 215, 0, ${i / bullet.trail.length * 0.5})`;
                    ctx.fillRect(point.x - 2, point.y, 4, 8);
                });
                
                ctx.shadowColor = '#FFD700';
                ctx.shadowBlur = 10;
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(bullet.x - 3, bullet.y - 10, 6, 20);
                ctx.shadowBlur = 0;
                
                return bullet.y > -20;
            });
        }
        
        // åˆ›å»ºç²’å­çˆ†ç‚¸
        function createExplosion(x, y, color, isCorrect) {
            const particleCount = isCorrect ? 50 : 30;
            for (let i = 0; i < particleCount; i++) {
                const angle = (Math.PI * 2 * i) / particleCount;
                const speed = 2 + Math.random() * 6;
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 1,
                    color: color,
                    size: Math.random() * 4 + 2
                });
            }
        }
        
        // æ›´æ–°ç²’å­
        function updateParticles() {
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1;
                p.life -= 0.015;
                
                if (p.life > 0) {
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.shadowColor = p.color;
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                    ctx.globalAlpha = 1;
                    return true;
                }
                return false;
            });
        }
        
        // æ˜¾ç¤ºé¼“åŠ±ç¬¦å·
        function showEncouragement(x, y) {
            const symbols = ['âœŒï¸', 'ğŸ‘Š', 'ğŸ¦¸', 'ğŸ…', 'â­', 'ğŸ’ª', 'ğŸ¯', 'ğŸ†'];
            const symbol = symbols[Math.floor(Math.random() * symbols.length)];
            
            const div = document.createElement('div');
            div.style.position = 'fixed';
            div.style.left = x + 'px';
            div.style.top = y + 'px';
            div.style.fontSize = '80px';
            div.style.transform = 'translate(-50%, -50%)';
            div.style.pointerEvents = 'none';
            div.style.zIndex = '200';
            div.style.animation = 'encourageAnim 1.5s ease-out forwards';
            div.textContent = symbol;
            document.body.appendChild(div);
            
            setTimeout(() => div.remove(), 1500);
        }
        
        // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
        function showCorrectAnswer() {
            const correctTarget = targets.find(t => t.isCorrect);
            if (!correctTarget) return;
            
            const div = document.createElement('div');
            div.style.position = 'fixed';
            div.style.left = '50%';
            div.style.top = '50%';
            div.style.transform = 'translate(-50%, -50%)';
            div.style.background = 'rgba(0, 0, 0, 0.9)';
            div.style.border = '4px solid #10B981';
            div.style.borderRadius = '20px';
            div.style.padding = '30px 50px';
            div.style.fontSize = '36px';
            div.style.color = '#10B981';
            div.style.fontWeight = 'bold';
            div.style.textAlign = 'center';
            div.style.zIndex = '300';
            div.style.boxShadow = '0 0 50px rgba(16, 185, 129, 0.5)';
            div.style.animation = 'correctAnswerAnim 2s ease-out forwards';
            
            div.innerHTML = `
                <div style="font-size: 24px; color: #FFD700; margin-bottom: 10px;">æ­£ç¡®ç­”æ¡ˆæ˜¯</div>
                <div>${correctTarget.text}</div>
            `;
            
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 2000);
        }
        
        // ç¢°æ’æ£€æµ‹
        function checkCollisions() {
            bullets.forEach(bullet => {
                targets.forEach(target => {
                    if (!target.hit && 
                        Math.abs(bullet.x - target.x) < target.size/2 + 10 &&
                        Math.abs(bullet.y - target.y) < target.size/2 + 10) {
                        
                        target.hit = true;
                        bullet.y = -100;
                        
                        lastHitTarget = target;
                        
                        createExplosion(target.x, target.y, '#60A5FA', false);
                        playSound('hit');
                        
                        if (!currentQuestionAnswered) {
                            currentQuestionAnswered = true;
                            
                            setTimeout(() => {
                                processAnswer();
                            }, 500);
                        }
                    }
                });
            });
            
            targets.forEach(target => {
                if (!target.hit && target.isCorrect && target.y > canvas.height + 50) {
                    if (!currentQuestionAnswered) {
                        currentQuestionAnswered = true;
                        combo = 0;
                        
                        wrongAnswers.push({
                            question: currentQuestionData.question,
                            correct: currentQuestionData.correctAnswer,
                            wrong: "æœªä½œç­”"
                        });
                        
                        if (lives > 0) {
                            lives--;
                            playSound('wrong');
                            updateUI();
                        }
                        
                        currentQuestion++;
                        loadQuestion();
                    }
                }
            });
        }
        
        // å¤„ç†ç­”æ¡ˆ
        function processAnswer() {
            if (!lastHitTarget) return;
            
            if (lastHitTarget.isCorrect) {
                score += 10;
                correctCount++;
                combo++;
                createExplosion(lastHitTarget.x, lastHitTarget.y, '#10B981', true);
                playSound('correct');
                
                showEncouragement(lastHitTarget.x, lastHitTarget.y);
                
                if (combo > maxCombo) maxCombo = combo;
                if (combo >= 2) {
                    const div = document.createElement('div');
                    div.className = 'combo-display';
                    div.innerHTML = `${combo}<br><span style="font-size: 40px;">è¿å‡»!</span>`;
                    document.body.appendChild(div);
                    setTimeout(() => div.remove(), 1000);
                }
            } else {
                combo = 0;
                lives--;
                createExplosion(lastHitTarget.x, lastHitTarget.y, '#EF4444', false);
                playSound('wrong');
                
                showCorrectAnswer();
                
                wrongAnswers.push({
                    question: currentQuestionData.question,
                    correct: currentQuestionData.correctAnswer,
                    wrong: lastHitTarget.text
                });
                
                updateUI();
                
                if (lives <= 0 && currentQuestion >= 9) {
                    setTimeout(() => endGame(), 2500);
                }
            }
            
            setTimeout(() => {
                currentQuestion++;
                loadQuestion();
            }, lastHitTarget.isCorrect ? 1000 : 2500);
        }
        
        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawBackground();
            
            if (gameState === 'playing') {
                drawJ20();
                drawTargets();
                drawBullets();
                updateParticles();
                checkCollisions();
                
                targets = targets.filter(t => t.isCorrect || t.y < canvas.height + 100);
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // é¼ æ ‡ç§»åŠ¨
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            crosshair.style.left = mouseX + 'px';
            crosshair.style.top = mouseY + 'px';
            
            if (gameState === 'playing') {
                plane.targetX = mouseX;
            }
        });
        
        // ç‚¹å‡»å°„å‡»
        canvas.addEventListener('click', (e) => {
            if (gameState === 'playing' && !currentQuestionAnswered && bullets.length === 0) {
                shoot();
            }
        });
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            initAudio();
            gameState = 'playing';
            score = 0;
            currentQuestion = 0;
            lives = 3;
            combo = 0;
            maxCombo = 0;
            correctCount = 0;
            wrongAnswers = [];
            targets = [];
            bullets = [];
            particles = [];
            
            questions = [...questionBank].sort(() => Math.random() - 0.5).slice(0, 10);
            
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameUI').style.display = 'block';
            
            loadQuestion();
        }
        
        // åŠ è½½é¢˜ç›®
        function loadQuestion() {
            if (currentQuestion < 10) {
                currentQuestionData = questions[currentQuestion];
                document.getElementById('question').textContent = currentQuestionData.question;
                createTargets();
                updateUI();
                currentQuestionAnswered = false;
                lastHitTarget = null;
            } else {
                endGame();
            }
        }
        
        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('current').textContent = currentQuestion + 1;
            document.getElementById('combo').textContent = combo;
            document.getElementById('lives').textContent = Math.max(0, lives);
        }
        
        // æ¸¸æˆç»“æŸ
        function endGame() {
            gameState = 'ended';
            document.getElementById('gameUI').style.display = 'none';
            document.getElementById('endScreen').style.display = 'flex';
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('accuracy').textContent = Math.round((correctCount / 10) * 100);
            document.getElementById('maxCombo').textContent = maxCombo;
            
            let grade = '';
            if (score >= 90 && lives > 0) grade = 'ğŸ† å®Œç¾é€šå…³ï¼å†å²å­¦éœ¸ï¼';
            else if (score >= 90) grade = 'ğŸŒŸ å†å²å­¦éœ¸ï¼';
            else if (score >= 80) grade = 'â­ ä¼˜ç§€ï¼';
            else if (score >= 70) grade = 'ğŸ‘ è‰¯å¥½ï¼';
            else if (score >= 60) grade = 'âœ… åŠæ ¼ï¼';
            else grade = 'ğŸ’ª ç»§ç»­åŠªåŠ›ï¼';
            
            document.getElementById('gradeDisplay').textContent = grade;
            
            const wrongDiv = document.getElementById('wrongAnswers');
            if (wrongAnswers.length > 0) {
                let html = '<h3 style="color: #FFD700; margin-bottom: 20px; font-size: 24px;">ğŸ“š é”™é¢˜å›é¡¾ï¼ˆè¯·è®¤çœŸå¤ä¹ ï¼‰ï¼š</h3>';
                wrongAnswers.forEach((item, index) => {
                    html += `<div class="wrong-item">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">
                            ${index + 1}. ${item.question}
                        </div>
                        <div style="margin-left: 20px;">
                            <div style="color: #10B981; margin-bottom: 4px;">
                                âœ… æ­£ç¡®ç­”æ¡ˆï¼š<span style="font-weight: bold;">${item.correct}</span>
                            </div>
                            <div style="color: #EF4444;">
                                âŒ ä½ çš„ç­”æ¡ˆï¼š<span style="font-weight: bold;">${item.wrong}</span>
                            </div>
                        </div>
                    </div>`;
                });
                wrongDiv.innerHTML = html;
            } else {
                wrongDiv.innerHTML = '<p style="color: #10B981; font-size: 28px; text-align: center; margin-top: 40px;">ğŸ‰ å¤ªæ£’äº†ï¼å…¨éƒ¨ç­”å¯¹ï¼æ»¡åˆ†é€šå…³ï¼</p>';
            }
        }
        
        // é‡æ–°å¼€å§‹
        function restartGame() {
            document.getElementById('endScreen').style.display = 'none';
            startGame();
        }
        
        // æ˜¾ç¤º/éšè—æ’è¡Œæ¦œ
        function toggleLeaderboard() {
            alert('æ’è¡Œæ¦œåŠŸèƒ½å·²å…³é—­');
        }
        
        // åˆå§‹åŒ–
        createStars();
        gameLoop();
        
        // éšè—ç³»ç»Ÿå…‰æ ‡
        document.body.style.cursor = 'none';
    </script>
</body>
</html>