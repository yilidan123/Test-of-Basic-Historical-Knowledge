```html<!DOCTYPE html><html lang="zh-CN"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>高考历史基础知识 - 太空射击挑战</title>    <style>        * {            margin: 0;            padding: 0;            box-sizing: border-box;            user-select: none;            -webkit-user-select: none; /* Safari */            -moz-user-select: none; /* Firefox */            -ms-user-select: none; /* IE10+ */            -webkit-tap-highlight-color: transparent; /* Remove tap highlight */        }        body {            font-family: 'Microsoft YaHei', Arial, sans-serif;            background: #000;            color: white;            overflow: hidden;            cursor: none; /* Hide cursor on desktop */        }        #gameCanvas {            display: block;            position: absolute;            top: 0;            left: 0;        }        #gameUI {            position: absolute;            top: 0;            left: 0;            width: 100%;            /* Increased top padding to make space for exit button and question */            padding: 60px 10px 10px 10px;            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);            pointer-events: none;            z-index: 10;        }        #question {            font-size: 20px; /* Adjusted font size */            color: #FFD700;            text-shadow: 0 0 15px #FFD700, 0 0 30px #FFD700;            margin-bottom: 15px; /* Adjusted margin */            font-weight: bold;            letter-spacing: 1px;            padding: 0 5px; /* Add padding for small screens */            /* New styles for left alignment on wrap */            max-width: 90%; /* Limit width to allow centering of the block */            margin-left: auto; /* Center the block */            margin-right: auto; /* Center the block */            text-align: left; /* Align text within the block to the left */        }        #stats {            /* Hide the stats bar */            display: none !important;        }        .stat-item {            background: linear-gradient(135deg, rgba(0,100,255,0.3), rgba(0,200,255,0.2));            padding: 8px 15px; /* Adjusted padding */            border-radius: 20px; /* Adjusted radius */            border: 1px solid rgba(0,200,255,0.6);            backdrop-filter: blur(5px);            font-size: 14px; /* Adjusted font size */            box-shadow: 0 0 10px rgba(0,200,255,0.4);            animation: statPulse 2s ease-in-out infinite;            margin: 3px; /* Add margin for wrapping */        }        @keyframes statPulse {            0%, 100% { transform: scale(1); }            50% { transform: scale(1.02); }        }        #crosshair {            position: fixed;            width: 40px; /* Smaller crosshair */            height: 40px;            pointer-events: none;            z-index: 1000;            transform: translate(-50%, -50%);            display: none; /* Hidden by default, shown for non-touch */        }        #startScreen, #endScreen {            position: absolute;            top: 0;            left: 0;            width: 100%;            height: 100%;            display: flex;            flex-direction: column;            justify-content: center;            align-items: center;            background: radial-gradient(circle at center, rgba(0,0,80,0.95), rgba(0,0,0,1));            z-index: 100;            text-align: center;            padding: 15px;        }        #endScreen {            display: none;        }        .game-title {            font-size: 36px; /* Adjusted font size */            color: #FFD700;            text-shadow: 0 0 20px #FFD700, 0 0 40px #FFA500;            margin-bottom: 20px;            animation: titleFloat 3s ease-in-out infinite;            letter-spacing: 2px;        }        @keyframes titleFloat {            0%, 100% { transform: translateY(0); }            50% { transform: translateY(-8px); }        }        .btn {            padding: 15px 35px; /* Adjusted padding */            font-size: 18px; /* Adjusted font size */            background: linear-gradient(135deg, #1E90FF, #00BFFF, #4169E1);            background-size: 200% 200%;            animation: btnGradient 3s ease infinite;            border: none;            border-radius: 40px;            color: white;            font-weight: bold;            cursor: pointer;            margin: 8px; /* Adjusted margin */            transition: all 0.3s;            box-shadow: 0 4px 20px rgba(30,144,255,0.5);            position: relative;            overflow: hidden;        }        @keyframes btnGradient {            0% { background-position: 0% 50%; }            50% { background-position: 100% 50%; }            100% { background-position: 0% 50%; }        }        .btn:hover {            transform: translateY(-2px) scale(1.03);            box-shadow: 0 6px 30px rgba(30,144,255,0.7);        }        .btn:active {            transform: translateY(-1px) scale(1.01);        }        #wrongAnswers {            margin-top: 15px; /* Adjusted margin */            width: 95%;            max-width: 900px;            max-height: 250px; /* Adjusted height */            overflow-y: auto;            background: rgba(0,0,0,0.6);            padding: 15px; /* Adjusted padding */            border-radius: 10px;            border: 1px solid rgba(255,215,0,0.3);            backdrop-filter: blur(5px);        }        .wrong-item {            background: linear-gradient(to right, rgba(255,0,0,0.15), rgba(255,0,0,0.05));            padding: 10px 15px; /* Adjusted padding */            margin: 8px 0; /* Adjusted margin */            border-radius: 8px;            border-left: 4px solid #FF4444;            font-size: 14px; /* Adjusted font size */            transition: all 0.3s;        }         .wrong-item div { /* Ensure text wraps */            white-space: normal;            word-wrap: break-word;        }        .wrong-item:hover {            background: linear-gradient(to right, rgba(255,0,0,0.25), rgba(255,0,0,0.15));            transform: translateX(3px);            box-shadow: 0 4px 15px rgba(255,0,0,0.2);        }        .combo-display {            position: fixed;            top: 50%;            left: 50%;            transform: translate(-50%, -50%);            font-size: 80px; /* Adjusted font size */            color: #FFD700;            font-weight: bold;            pointer-events: none;            text-shadow: 0 0 40px #FFD700, 0 0 80px #FFA500;            animation: comboAnim 1s ease-out forwards;            z-index: 50;        }        @keyframes comboAnim {            0% { transform: translate(-50%, -50%) scale(0) rotate(-360deg); opacity: 0; }            50% { transform: translate(-50%, -50%) scale(1.3) rotate(0deg); opacity: 1; }            100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); opacity: 0; }        }        #soundToggle {            position: absolute;            top: 15px; /* Adjusted position */            right: 15px;            background: rgba(0,0,0,0.5);            border: 1px solid #FFD700;            border-radius: 50%;            width: 40px; /* Adjusted size */            height: 40px;            display: flex;            align-items: center;            justify-content: center;            cursor: pointer;            font-size: 20px; /* Adjusted font size */            z-index: 101;            pointer-events: auto; /* Enable clicks */        }        #soundToggle:hover { background: rgba(255,215,0,0.2); }        /* Moved encouragement symbol to center */        @keyframes encourageAnim {            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }            50% { transform: translate(-50%, -50%) scale(1.8); opacity: 1; }            100% { transform: translate(-50%, -50%) scale(1.3); opacity: 0; }        }        @keyframes correctAnswerAnim {            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }        }         /* Responsive Adjustments */        @media (min-width: 768px) {            #gameUI { padding: 50px 20px 20px 20px; } /* More padding on desktop */            #question {                font-size: 28px;                margin-top: 0;                margin-bottom: 20px;                text-align: center; /* Center on desktop */                max-width: 100%; /* No max width restriction on desktop */            }            .stat-item { padding: 12px 25px; border-radius: 30px; font-size: 18px; margin: 5px; }            .game-title { font-size: 56px; }            .btn { padding: 18px 50px; font-size: 22px; }            #wrongAnswers { padding: 25px; max-height: 350px; }            .wrong-item { padding: 15px 20px; font-size: 17px; }            .combo-display { font-size: 100px; }            #soundToggle { width: 50px; height: 50px; font-size: 24px; top: 20px; right: 20px; }            #crosshair { display: block; } /* Show crosshair on larger screens */            #exitGameBtn { display: none !important; } /* Hide on desktop */            #mobileShootInstructionStart { display: none !important; } /* Hide start instruction on desktop */        }         /* Make leaderboard scrollable - REMOVED */        /* #leaderboard {            margin-top: 20px;            max-width: 90%;            max-height: 150px;            overflow-y: auto;            background: rgba(0,0,0,0.4);            padding: 15px;            border-radius: 10px;            border: 1px solid rgba(0,200,255,0.3);        } */        #exitGameBtn {            position: absolute;            top: 15px; /* Position for mobile */            left: 15px; /* Position for mobile */            font-size: 16px;            padding: 8px 15px;            background: rgba(255, 0, 0, 0.6);            border: 1px solid #FF4444;            border-radius: 20px;            color: white;            cursor: pointer;            z-index: 10;            display: none; /* Hidden by default, shown for touch devices via JS */            pointer-events: auto; /* Enable clicks */        }        /* Mobile specific adjustments for question position */        @media (max-width: 767px) {            #question {                /* Position below exit button with some margin */                margin-top: 0; /* Reset margin-top from previous version */                position: absolute;                top: 55px; /* Adjust based on exit button height + margin */                left: 50%;                transform: translateX(-50%);                width: 95%; /* Adjust width to fit screen */            }            /* #leaderboard {                display: none !important;            } */            #mobileShootInstructionStart {                display: block; /* Show instruction on mobile start screen */                /* Position it above the start button */                margin-bottom: 15px; /* Added margin to push it up */                margin-top: 0; /* Ensure no top margin */                color: #00BFFF;                font-size: 14px;                text-shadow: 0 0 5px #00BFFF;                z-index: 10;                pointer-events: none; /* Make it unclickable */            }             #gameUI #mobileShootInstruction { /* Hide the in-game instruction */                display: none !important;            }             /* Center the text within its parent */             #startScreen #mobileShootInstructionStart {                position: relative; /* Change to relative to be in flow */                width: auto; /* Allow content to dictate width */                transform: none; /* Remove transform */                left: auto; /* Remove left positioning */             }        }    </style></head><body>    <canvas id="gameCanvas"></canvas>    <div id="crosshair">        <svg width="50" height="50">            <circle cx="25" cy="25" r="20" fill="none" stroke="#FFD700" stroke-width="2" opacity="0.8"/>            <circle cx="25" cy="25" r="3" fill="#FFD700"/>            <line x1="25" y1="5" x2="25" y2="15" stroke="#FFD700" stroke-width="2"/>            <line x1="25" y1="35" x2="25" y2="45" stroke="#FFD700" stroke-width="2"/>            <line x1="5" y1="25" x2="15" y2="25" stroke="#FFD700" stroke-width="2"/>            <line x1="35" y1="25" x2="45" y2="25" stroke="#FFD700" stroke-width="2"/>        </svg>    </div>    <div id="soundToggle" onclick="toggleSound()">🔊</div>    <div id="gameUI" style="display: none;">        <button id="exitGameBtn" onclick="exitGame()">退出游戏</button>        <div id="question"></div>        <div id="stats">            <div class="stat-item">🎯 得分: <span id="score">0</span>/100</div>            <div class="stat-item">📝 第 <span id="current">1</span>/10 题</div>            <div class="stat-item">🔥 连击: <span id="combo">0</span></div>            <div class="stat-item">❤️ 生命: <span id="lives">3</span></div>        </div>        <div id="mobileShootInstruction"></div>    </div>    <div id="startScreen">        <h1 class="game-title">🚀 高中历史基础知识 🚀</h1>        <p style="font-size: 18px; margin-bottom: 8px; color: #00BFFF;">太空射击挑战</p>        <p style="font-size: 16px; margin-bottom: 25px; color: #87CEEB;">驾驶歼-20战机，射击正确的历史答案！</p>        <p id="mobileShootInstructionStart" style="font-size: 14px; color: #00BFFF; text-shadow: 0 0 5px #00BFFF; padding: 0 15px; margin-bottom: 15px;">双击飞机才能发射噢！</p>        <button class="btn" onclick="startGame()">🎮 开始挑战</button>        <div style="position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); text-align: center; width: 100%;">            <p style="font-size: 14px; color: #FFD700; margin-bottom: 3px;">开发者：伊利丹</p>            <p style="font-size: 12px; color: #87CEEB;">© 2025 高中历史学习游戏</p>        </div>        </div>    <div id="endScreen">        <h1 class="game-title" style="font-size: 32px; margin-bottom: 20px;">🎯 挑战结束 🎯</h1>        <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">            <div style="text-align: center;">                <p style="font-size: 16px; color: #87CEEB; margin-bottom: 5px;">最终得分</p>                <p style="font-size: 42px; color: #FFD700; font-weight: bold;"><span id="finalScore">0</span>/100</p>            </div>            <div style="text-align: center;">                <p style="font-size: 16px; color: #87CEEB; margin-bottom: 5px;">正确率</p>                <p style="font-size: 42px; color: #00BFFF; font-weight: bold;"><span id="accuracy">0</span>%</p>            </div>            <div style="text-align: center;">                <p style="font-size: 16px; color: #87CEEB; margin-bottom: 5px;">最高连击</p>                <p style="font-size: 42px; color: #FF6B35; font-weight: bold;"><span id="maxCombo">0</span></p>            </div>        </div>        <div class="grade-display" id="gradeDisplay" style="font-size: 28px; margin-bottom: 20px;"></div>        <button class="btn" onclick="restartGame()" style="font-size: 20px; padding: 18px 50px; margin-bottom: 20px;">🔄 再战一次</button>        <div id="wrongAnswers" style="max-height: 200px; width: 90%; max-width: 900px;"></div>    </div>    <script>        const canvas = document.getElementById('gameCanvas');        const ctx = canvas.getContext('2d');        const crosshair = document.getElementById('crosshair');        const exitGameBtn = document.getElementById('exitGameBtn');        const mobileShootInstructionStart = document.getElementById('mobileShootInstructionStart'); // Renamed for clarity        let audioContext = null;        let soundEnabled = true;        let isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;        function initAudio() {            if (!audioContext) {                try {                   audioContext = new (window.AudioContext || window.webkitAudioContext)();                } catch(e) {                    console.error("Web Audio API is not supported in this browser");                    soundEnabled = false;                }            }        }        // Function to attempt to resume audio context        function resumeAudio() {             if(soundEnabled && audioContext && audioContext.state === 'suspended') {                audioContext.resume().catch(e => console.error("Audio resume failed:", e));             }        }        function playSound(type) {            if (!soundEnabled || !audioContext || audioContext.state === 'suspended') return;            const osc = audioContext.createOscillator();            const gain = audioContext.createGain();            osc.connect(gain);            gain.connect(audioContext.destination);            switch(type) {                case 'shoot':                    osc.frequency.value = 800;                    osc.type = 'square';                    gain.gain.setValueAtTime(0.08, audioContext.currentTime); // Reduced volume slightly                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);                    osc.start();                    osc.stop(audioContext.currentTime + 0.1);                    break;                case 'hit':                    osc.frequency.value = 400;                    osc.type = 'sine';                    gain.gain.setValueAtTime(0.15, audioContext.currentTime); // Reduced volume slightly                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);                    osc.start();                    osc.stop(audioContext.currentTime + 0.3);                    break;                case 'correct':                    [523.25, 659.25, 783.99].forEach((freq, i) => {                        const o = audioContext.createOscillator();                        const g = audioContext.createGain();                        o.connect(g);                        g.connect(audioContext.destination);                        o.frequency.value = freq;                        o.type = 'sine';                        g.gain.setValueAtTime(0.08, audioContext.currentTime + i * 0.08); // Reduced volume slightly                        g.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.08 + 0.15);                        o.start(audioContext.currentTime + i * 0.08);                        o.stop(audioContext.currentTime + i * 0.08 + 0.15);                    });                    break;                case 'wrong':                    osc.frequency.value = 200;                    osc.type = 'sawtooth';                    gain.gain.setValueAtTime(0.15, audioContext.currentTime); // Reduced volume slightly                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);                    osc.start();                    osc.stop(audioContext.currentTime + 0.5);                    break;            }        }        function toggleSound() {            soundEnabled = !soundEnabled;            document.getElementById('soundToggle').textContent = soundEnabled ? '🔊' : '🔇';            resumeAudio(); // Try resuming if sound is turned on        }        function resizeCanvas() {            canvas.width = window.innerWidth;            canvas.height = window.innerHeight;            // Adjust plane y position based on device type            plane.y = canvas.height - (isTouchDevice ? 200 : 150);            createStars();            createNebulae();        }        window.addEventListener('resize', resizeCanvas);        let gameState = 'menu';        let score = 0;        let currentQuestion = 0;        // let lives = 3; // REMOVED LIVES        let combo = 0;        let maxCombo = 0;        let questions = [];        let currentQuestionData = null;        let targets = [];        let bullets = [];        let particles = [];        let stars = [];        let nebulae = [];        let shootingStars = [];        let wrongAnswers = [];        let correctCount = 0;        let mouseX = 0;        let mouseY = 0;        let currentQuestionAnswered = false;        let lastHitTarget = null;        let isDragging = false;        let lastTapTime = 0;        let plane = {            x: window.innerWidth / 2,            y: window.innerHeight - 150, // Initial default, will be adjusted by resizeCanvas            targetX: window.innerWidth / 2,            angle: 0,            speed: 0.2        };        const questionBank =[            { question: "当前官方观点是：中国有_____年的文明史", correctAnswer: "5千", wrongAnswers: ["100万年", "1万年", "3千年"] },            { question: "科举制废除于_____时期", correctAnswer: "清末新政", wrongAnswers: ["中华民国临时政府", "新文化运动", "戊戌变法"] },            { question: "科举制正式废除于_____年", correctAnswer: "1905", wrongAnswers: ["1911", "1912", "1901"] },            { question: "当前官方观点是：_____文化，实证中华文明五千年", correctAnswer: "良渚", wrongAnswers: ["陶寺", "红山", "仰韶"] },            { question: "战国初期，对儒家构成巨大压力的是_____。", correctAnswer: "墨家与杨朱学派", wrongAnswers: ["法家与道家", "佛教与道教", "宗教神学观"] },            { question: "小农经济产生于_____时期。", correctAnswer: "春秋战国", wrongAnswers: ["新石器时代初期", "西周", "魏晋庄园经济"] },            { question: "儒学在汉代开始了_____化。", correctAnswer: "神学", wrongAnswers: ["伦理学", "哲学", "科学"] },            { question: "儒学在_____时期完成了哲学化。", correctAnswer: "宋明", wrongAnswers: ["战国", "汉代", "明清"] },            { question: "新疆在_____时期正式纳入中国版图。", correctAnswer: "西汉", wrongAnswers: ["秦朝", "唐朝", "元朝"] },            { question: "西藏在_____时期正式纳入中国版图。", correctAnswer: "元朝", wrongAnswers: ["汉朝", "唐朝", "明朝"] },            { question: "康熙时期，清政府在台湾设____，隶属福建省", correctAnswer: "府", wrongAnswers: ["县", "州", "省"] },            { question: "_____战争后，清政府在台湾正式设省。", correctAnswer: "中法", wrongAnswers: ["鸦片", "甲午中日", "八国联军侵华"] },            { question: "私营手工业超过官营开始于_____", correctAnswer: "明朝中后期", wrongAnswers: ["春秋战国", "宋元时期", "鸦片战争后"] },            { question: "书法绘画等从注重实用发展到自觉追求审美始于____时期", correctAnswer: "魏晋", wrongAnswers: ["陶寺", "春秋战国", "唐"] },            { question: "“华夏认同”观念开始于____时期", correctAnswer: "东周", wrongAnswers: ["新石器时代", "西周", "秦汉"] },            { question: "租庸调制从____开始实行", correctAnswer: "唐朝", wrongAnswers: ["汉", "北魏", "清"] },            { question: "率先在全国通行纸币的是___", correctAnswer: "元代", wrongAnswers: ["汉武帝以后", "宋代", "明代"] },            { question: "设立内阁大学士的是____", correctAnswer: "明成祖", wrongAnswers: ["明太祖", "明宪宗", "万历帝"] },            { question: "_____，经济重心开始南移。", correctAnswer: "安史之乱后", wrongAnswers: ["魏晋南北朝", "两宋时期", "明中后期"] },            { question: "明朝起止时间是____年", correctAnswer: "1368--1644", wrongAnswers: ["960--1279", "1566--1644", "1644-1765"] },            { question: "中国自然经济开始解体于_____", correctAnswer: "鸦片战争后", wrongAnswers: ["晚明时期", "甲午战后", "新中国成立"] },            { question: "与中国同盟会产生同一年的是____", correctAnswer: "五大臣出洋考察宪政", wrongAnswers: ["甲午中日战争", "《辛丑条约》签订", "“皇族内阁”产生"] },            { question: "与“皇族内阁”同一年出现的是____", correctAnswer: "武昌起义", wrongAnswers: ["《辛丑条约》签订", "《钦定宪法大纲》颁布", "光绪和慈禧去世"] },            { question: "东南互保与____同时", correctAnswer: "义和团运动", wrongAnswers: ["太平天国运动", "洋务运动", "辛亥革命"] },            { question: "列宁逝世同一年发生的是____", correctAnswer: "国民党一大召开", wrongAnswers: ["五四运动", "北伐开始", "南昌起义"] },            { question: "与国民党形式上统一全国在同一年的是____", correctAnswer: "井冈山会师", wrongAnswers: ["南昌起义", "井冈山根据地开始建立", "中原大战"] },            { question: "甲午战后____年，日俄战争爆发。", correctAnswer: "十", wrongAnswers: ["两年", "五年", "二十年"] },            { question: "国民党政府推行法币政策是在____年", correctAnswer: "1935", wrongAnswers: ["1933", "1937", "1948"] },            { question: "国民党政府“训政”阶段的时间是____年期间。", correctAnswer: "1928--1948", wrongAnswers: ["1912--1927", "1927--1937", "1937--1945"] },            { question: "义和团运动的背景是______。", correctAnswer: "天津教案", wrongAnswers: ["鸦片贸易", "金田起义", "《辛丑条约》"] },            { question: "《资政新篇》颁布的同一年，_____发表。", correctAnswer: "《物种起源》", wrongAnswers: ["“日心说”", "《天朝田亩制度》", "三民主义"] },            { question: "太平天国运动的起止时间是____年。", correctAnswer: "1851--1864", wrongAnswers: ["1856--1860", "1861--1895", "1860--1885"] },            { question: "《天朝田亩制度》颁布100周年时，中国开始进行_____。", correctAnswer: "农业合作化", wrongAnswers: ["土地改革运动", "人民公社化", "家庭联产承包责任制"] },            { question: "不属于中国19世纪70年代出现的是____。", correctAnswer: "中法战争", wrongAnswers: ["民族资本主义产生", "洋务派民用工业开始", "边疆危机"] },            { question: "属于中国19世纪40年代出现的是____。", correctAnswer: "五口通商", wrongAnswers: ["洋务运动", "火烧圆明园", "太平天国运动"] },            { question: "属于中国19世纪50年代出现的是____。", correctAnswer: "农民运动达到了最高峰", wrongAnswers: ["近代工业化开始", "边疆危机", "安庆内军械所"] },            { question: "甲午中日战争发生在____年。", correctAnswer: "1894--1895", wrongAnswers: ["1883--1885", "1898", "1900--1901"] },            { question: "列强对华资本输出为主的时间是____以后。", correctAnswer: "甲午战争", wrongAnswers: ["鸦片战争", "太平天国运动", "《辛丑条约》签订"] },            { question: "列强瓜分中国的狂潮始于____。", correctAnswer: "甲午战后", wrongAnswers: ["一战时期", "英法联军火烧圆明园", "北洋军阀时期"] },            { question: "清政府宣布“预备立宪”开始于____年。", correctAnswer: "1906", wrongAnswers: ["1901", "1905", "1908"] },            { question: "不属于1908年发生的是____。", correctAnswer: "“皇族内阁”出台", wrongAnswers: ["慈禧去世", "《钦定宪法大纲》", "光绪去世"] },            { question: "属于1912年1月份的是____。", correctAnswer: "民国建立", wrongAnswers: ["清朝灭亡", "北洋政府成立", "《临时约法》颁布"] },            { question: "两税法产生的背景是____。", correctAnswer: "安史之乱以后", wrongAnswers: ["贞观年间", "开元盛世", "均田制盛行"] },            { question: "设置驻藏大臣的朝代是____朝。", correctAnswer: "清", wrongAnswers: ["汉", "唐", "元"] },            { question: "设置十三行对外贸易机构的是____朝。", correctAnswer: "清", wrongAnswers: ["唐", "宋", "元"] },            { question: "两条丝绸之路最早开通于____朝。", correctAnswer: "汉", wrongAnswers: ["秦", "唐", "元"] },            { question: "不属于汉武帝时期的是实行____政策。", correctAnswer: "削藩", wrongAnswers: ["五经博士", "中朝制", "盐铁官营"] },            { question: "下列属于汉武帝时期与西域关系的是____。", correctAnswer: "张骞通西域", wrongAnswers: ["设立西域都护", "设立安西都护府", "设立北庭都护府"] },            { question: "世界上最早由国家颁行的药典是在____朝。", correctAnswer: "唐", wrongAnswers: ["汉", "宋", "元"] },            { question: "中国现存最早的一部完整的农书产生于____时期。", correctAnswer: "北朝", wrongAnswers: ["汉朝", "唐朝", "五代"] },            { question: "“取士不问家世，婚姻不问阀阅”是____代的现象。", correctAnswer: "宋", wrongAnswers: ["周", "魏晋", "唐"] },            { question: "理学成为官方正统思想的是在____。", correctAnswer: "南宋以后", wrongAnswers: ["北宋中期", "南宋中期", "明朝初期"] },            { question: "倭寇不断对我国东部沿海进行侵扰开始于____。", correctAnswer: "元朝末期", wrongAnswers: ["两宋之际", "明朝初期", "明朝中期"] },            { question: "《尼布楚条约》签订在____年。", correctAnswer: "1689", wrongAnswers: ["1553", "1662", "1684"] },            { question: "思想家李贽是____的重要思想家。", correctAnswer: "明朝中后期", wrongAnswers: ["明朝中期", "明末清初", "清朝中期"] },            { question: "京剧形成于清朝____时期。", correctAnswer: "道光", wrongAnswers: ["康熙", "乾隆", "同治"] },            { question: "道教兴起于____。", correctAnswer: "东汉末年", wrongAnswers: ["春秋", "战国", "西汉末期"] },            { question: "安史之乱发生的时间是____。", correctAnswer: "8世纪中期", wrongAnswers: ["6世纪晚期", "7世纪初期", "10世纪初期"] }        ];        function createStars() {            stars = [];            for (let i = 0; i < 250; i++) {                stars.push({                    x: Math.random() * canvas.width,                    y: Math.random() * canvas.height,                    size: Math.random() * 1.8 + 0.3,                    speed: Math.random() * 0.4 + 0.05,                    brightness: Math.random() * 0.5 + 0.1                });            }        }        function createNebulae() {             nebulae = [];             const nebulaCount = 2;             const colors = [                { r: 50, g: 20, b: 120, a: 0.03 },                { r: 20, g: 80, b: 150, a: 0.03 },             ];             for(let i = 0; i < nebulaCount; i++) {                 const color = colors[i % colors.length];                 nebulae.push({                     x: Math.random() * canvas.width * 1.5 - canvas.width * 0.25,                     y: Math.random() * canvas.height * 1.5 - canvas.height * 0.25,                     radius: Math.random() * canvas.width * 0.5 + canvas.width * 0.3,                     color: `rgba(${color.r}, ${color.g}, ${color.b}, ${color.a})`,                     speedY: Math.random() * 0.08 + 0.02,                     speedX: (Math.random() - 0.5) * 0.08                 });             }        }         function createShootingStar() {            if (Math.random() < 0.003 && shootingStars.length < 2) {                const startX = Math.random() * canvas.width;                const startY = Math.random() * 50;                const angle = Math.PI / 4 + (Math.random() * Math.PI / 4);                const speed = Math.random() * 10 + 8;                shootingStars.push({                    x: startX,                    y: startY,                    vx: Math.cos(angle) * speed * (Math.random() > 0.5 ? 1 : -1),                    vy: Math.sin(angle) * speed,                    life: 1,                    length: Math.random() * 80 + 40                });            }        }        function drawBackground() {            ctx.fillStyle = '#000000';            ctx.fillRect(0, 0, canvas.width, canvas.height);            nebulae.forEach(nebula => {                const gradient = ctx.createRadialGradient(nebula.x, nebula.y, 0, nebula.x, nebula.y, nebula.radius);                gradient.addColorStop(0, nebula.color.replace('0.03', '0.08'));                gradient.addColorStop(1, nebula.color.replace('0.03', '0'));                ctx.fillStyle = gradient;                ctx.beginPath();                ctx.arc(nebula.x, nebula.y, nebula.radius, 0, Math.PI * 2);                ctx.fill();                nebula.y += nebula.speedY;                nebula.x += nebula.speedX;                if (nebula.y > canvas.height + nebula.radius) nebula.y = -nebula.radius;                if (nebula.x > canvas.width + nebula.radius) nebula.x = -nebula.radius;                if (nebula.x < -nebula.radius) nebula.x = canvas.width + nebula.radius;            });            stars.forEach(star => {                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;                ctx.fillRect(star.x, star.y, star.size, star.size);                star.y += star.speed;                if (star.y > canvas.height + 10) {                    star.y = -10;                    star.x = Math.random() * canvas.width;                }            });            createShootingStar();            shootingStars = shootingStars.filter(ss => {                ctx.strokeStyle = `rgba(255, 255, 220, ${ss.life * 0.6})`;                ctx.lineWidth = 1.5 * ss.life;                ctx.beginPath();                ctx.moveTo(ss.x, ss.y);                ctx.lineTo(ss.x - ss.vx * ss.length * 0.05, ss.y - ss.vy * ss.length * 0.05);                ctx.stroke();                ss.x += ss.vx;                ss.y += ss.vy;                ss.life -= 0.015;                return ss.life > 0 && ss.x > -50 && ss.x < canvas.width + 50 && ss.y < canvas.height + 50;            });        }        function drawJ20() {            plane.x += (plane.targetX - plane.x) * plane.speed;            plane.angle = (plane.targetX - plane.x) * 0.0002;            ctx.save();            ctx.translate(plane.x, plane.y);            ctx.rotate(plane.angle);            ctx.shadowColor = 'rgba(0, 200, 255, 0.5)';            ctx.shadowBlur = 20;            const bodyGradient = ctx.createLinearGradient(0, -50, 0, 50);            bodyGradient.addColorStop(0, '#4A5568');            bodyGradient.addColorStop(0.5, '#2D3748');            bodyGradient.addColorStop(1, '#1A202C');            ctx.fillStyle = bodyGradient;            ctx.beginPath();            ctx.moveTo(0, -50); ctx.lineTo(-10, -30); ctx.lineTo(-15, 0);            ctx.lineTo(-18, 35); ctx.lineTo(-12, 50); ctx.lineTo(0, 45);            ctx.lineTo(12, 50); ctx.lineTo(18, 35); ctx.lineTo(15, 0);            ctx.lineTo(10, -30); ctx.closePath(); ctx.fill();            ctx.fillStyle = '#1A202C';            ctx.beginPath(); ctx.moveTo(-15, -5); ctx.lineTo(-50, 20);            ctx.lineTo(-45, 40); ctx.lineTo(-18, 30); ctx.closePath(); ctx.fill();            ctx.beginPath(); ctx.moveTo(15, -5); ctx.lineTo(50, 20);            ctx.lineTo(45, 40); ctx.lineTo(18, 30); ctx.closePath(); ctx.fill();            ctx.fillStyle = '#2D3748';            ctx.beginPath(); ctx.moveTo(-10, -38); ctx.lineTo(-30, -25);            ctx.lineTo(-25, -15); ctx.lineTo(-10, -28); ctx.closePath(); ctx.fill();            ctx.beginPath(); ctx.moveTo(10, -38); ctx.lineTo(30, -25);            ctx.lineTo(25, -15); ctx.lineTo(10, -28); ctx.closePath(); ctx.fill();            const cockpitGradient = ctx.createRadialGradient(0, -25, 0, 0, -25, 15);            cockpitGradient.addColorStop(0, 'rgba(100, 200, 255, 0.9)');            cockpitGradient.addColorStop(1, 'rgba(50, 150, 200, 0.6)');            ctx.fillStyle = cockpitGradient;            ctx.beginPath(); ctx.ellipse(0, -25, 8, 15, 0, 0, Math.PI * 2); ctx.fill();            ctx.shadowColor = 'rgba(255, 100, 0, 0.8)'; ctx.shadowBlur = 30;            for (let i = -1; i <= 1; i += 2) {                const flameLength = 30 + Math.random() * 20;                const flameGradient = ctx.createLinearGradient(i*8, 45, i*8, 45 + flameLength);                flameGradient.addColorStop(0, 'rgba(255, 200, 100, 0.9)');                flameGradient.addColorStop(0.5, 'rgba(255, 100, 50, 0.7)');                flameGradient.addColorStop(1, 'rgba(255, 50, 0, 0)');                ctx.fillStyle = flameGradient;                ctx.beginPath(); ctx.moveTo(i*8 - 5, 45); ctx.lineTo(i*8 - 3, 50);                ctx.lineTo(i*8, 45 + flameLength); ctx.lineTo(i*8 + 3, 50);                ctx.lineTo(i*8 + 5, 45); ctx.closePath(); ctx.fill();            }            ctx.shadowBlur = 0; ctx.restore();        }        function createAsteroidShape(points = 12, minRadiusFactor = 0.7, maxRadiusFactor = 1.3) {            const shapeData = [];            for (let i = 0; i < points; i++) {                shapeData.push({                    angle: (i / points) * Math.PI * 2,                    radiusOffset: (Math.random() * (maxRadiusFactor - minRadiusFactor) + minRadiusFactor)                });            }            return shapeData;        }        function createTargets() {            if (!currentQuestionData) return;            targets = [];            const answers = [currentQuestionData.correctAnswer, ...currentQuestionData.wrongAnswers.slice(0, 3)];            for (let i = answers.length - 1; i > 0; i--) {                const j = Math.floor(Math.random() * (i + 1));                [answers[i], answers[j]] = [answers[j], answers[i]];            }            // Adjust target size based on device type and screen width            const targetSize = isTouchDevice ? Math.min(canvas.width / 3.5, 100) : Math.min(canvas.width / 4.5, 120);            const speedMultiplier = isTouchDevice ? 0.8 : 1;            for (let i = 0; i < 4; i++) {                // Add random Y offset for staggering                const initialYOffset = -150 - Math.random() * 100 - (i * 20); // More initial stagger                targets.push({                    x: (i + 0.5) * (canvas.width / 4),                    y: initialYOffset,                    text: answers[i],                    isCorrect: answers[i] === currentQuestionData.correctAnswer,                    speed: (1.05 + currentQuestion * 0.05) * speedMultiplier,                    angle: Math.random() * Math.PI * 2,                    rotationSpeed: (Math.random() - 0.5) * 0.02,                    shapeData: createAsteroidShape(),                    size: targetSize,                    hit: false,                    opacity: 1,                    glowPhase: Math.random() * Math.PI * 2,                    baseColor: `hsl(${200 + Math.random() * 60}, 30%, ${30 + Math.random() * 20}%)`                });            }        }        function drawTargets() {            targets.forEach(target => {                if (target.hit) return;                ctx.save();                ctx.translate(target.x, target.y);                ctx.rotate(target.angle);                ctx.fillStyle = target.baseColor;                ctx.shadowColor = 'rgba(50, 50, 80, 0.5)';                ctx.shadowBlur = 15;                ctx.beginPath();                target.shapeData.forEach((point, i) => {                    const radius = (target.size / 2) * point.radiusOffset;                    const x = Math.cos(point.angle) * radius;                    const y = Math.sin(point.angle) * radius;                    if (i === 0) ctx.moveTo(x, y);                    else ctx.lineTo(x, y);                });                ctx.closePath();                ctx.fill();                ctx.shadowBlur = 0;                ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';                ctx.lineWidth = 1.5;                ctx.beginPath();                for(let i = 0; i < 3; i++) {                    const startAngle = Math.random() * Math.PI * 2;                    const endAngle = startAngle + (Math.random() * 0.5 + 0.5);                    ctx.moveTo(Math.cos(startAngle) * target.size * 0.2, Math.sin(startAngle) * target.size * 0.2);                    ctx.lineTo(Math.cos(endAngle) * target.size * 0.4, Math.sin(endAngle) * target.size * 0.4);                }                ctx.stroke();                ctx.restore();                ctx.save();                ctx.translate(target.x, target.y);                const fontSize = Math.max(16, target.size * 0.18); // Slightly smaller min font for mobile                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';                ctx.font = `bold ${fontSize}px Microsoft YaHei`;                ctx.textAlign = 'center';                ctx.textBaseline = 'middle';                ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';                ctx.shadowBlur = 5;                ctx.shadowOffsetX = 1;                ctx.shadowOffsetY = 1;                // Draw text with word wrap                const maxTextWidth = target.size * 0.9; // Allow text to take up 90% of asteroid width                wrapText(ctx, target.text, 0, 0, maxTextWidth, fontSize * 1.2); // Line height 1.2 times font size                ctx.restore();                target.y += target.speed;                target.angle += target.rotationSpeed;            });        }        // Helper function for wrapping text        function wrapText(context, text, x, y, maxWidth, lineHeight) {            const words = text.split(''); // Split by character for Chinese            let line = '';            let currentY = y - (lineHeight / 2); // Initial Y adjustment            for (let n = 0; n < words.length; n++) {                const testLine = line + words[n];                const metrics = context.measureText(testLine);                const testWidth = metrics.width;                if (testWidth > maxWidth && n > 0) {                    context.fillText(line, x, currentY);                    line = words[n];                    currentY += lineHeight;                } else {                    line = testLine;                }            }            context.fillText(line, x, currentY);        }        // Modified shoot function: Always shoots straight up        function shoot() {            bullets.push({                x: plane.x,                y: plane.y - 50,                vx: 0,       // Always 0                vy: -15,     // Always -15                trail: []            });            playSound('shoot');        }        function drawBullets() {            bullets = bullets.filter(bullet => {                bullet.x += bullet.vx;                bullet.y += bullet.vy;                bullet.trail.push({x: bullet.x, y: bullet.y});                if (bullet.trail.length > 10) bullet.trail.shift();                bullet.trail.forEach((point, i) => {                    ctx.fillStyle = `rgba(255, 215, 0, ${i / bullet.trail.length * 0.5})`;                    ctx.fillRect(point.x - 2, point.y, 4, 8);                });                ctx.shadowColor = '#FFD700'; ctx.shadowBlur = 10;                ctx.fillStyle = '#FFD700';                ctx.fillRect(bullet.x - 3, bullet.y - 10, 6, 20);                ctx.shadowBlur = 0;                return bullet.y > -20 && bullet.x > -10 && bullet.x < canvas.width + 10;            });        }        function createExplosion(x, y, color, isCorrect) {            const particleCount = isCorrect ? 50 : 30;            for (let i = 0; i < particleCount; i++) {                const angle = Math.random() * Math.PI * 2;                const speed = 2 + Math.random() * 6;                particles.push({                    x: x, y: y,                    vx: Math.cos(angle) * speed * (Math.random() + 0.5),                    vy: Math.sin(angle) * speed * (Math.random() + 0.5),                    life: 1, color: color, size: Math.random() * 4 + 2                });            }        }        function updateParticles() {            particles = particles.filter(p => {                p.x += p.vx; p.y += p.vy;                p.vy += 0.1; p.life -= 0.015;                if (p.life > 0) {                    ctx.globalAlpha = p.life;                    ctx.fillStyle = p.color;                    ctx.shadowColor = p.color; ctx.shadowBlur = 10;                    ctx.beginPath(); ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);                    ctx.fill(); ctx.shadowBlur = 0; ctx.globalAlpha = 1;                    return true;                }                return false;            });        }        function showEncouragement() { // Removed x, y parameters            const symbols = ['✌️', '👊', '🦸', '🏅', '⭐', '💪', '🎯', '🏆'];            const symbol = symbols[Math.floor(Math.random() * symbols.length)];            const div = document.createElement('div');            div.style.position = 'fixed';            div.style.left = '50%'; // Centered            div.style.top = '50%';  // Centered            div.style.fontSize = '60px';            div.style.transform = 'translate(-50%, -50%)'; // Centered            div.style.pointerEvents = 'none'; div.style.zIndex = '200';            div.style.animation = 'encourageAnim 1.5s ease-out forwards';            div.textContent = symbol; document.body.appendChild(div);            setTimeout(() => div.remove(), 1500);        }        function showCorrectAnswer() {            const correctTarget = targets.find(t => t.isCorrect);            if (!correctTarget) return;            const div = document.createElement('div');            div.style.position = 'fixed'; div.style.left = '50%';            div.style.top = '50%'; div.style.transform = 'translate(-50%, -50%)';            div.style.background = 'rgba(0, 0, 0, 0.9)';            div.style.border = '3px solid #10B981';            div.style.borderRadius = '15px';            div.style.padding = '20px 30px';            div.style.fontSize = '24px';            div.style.color = '#10B981'; div.style.fontWeight = 'bold';            div.style.textAlign = 'center'; div.style.zIndex = '300';            div.style.boxShadow = '0 0 30px rgba(16, 185, 129, 0.5)';            div.style.animation = 'correctAnswerAnim 2s ease-out forwards';            div.innerHTML = `                <div style="font-size: 18px; color: #FFD700; margin-bottom: 8px;">正确答案是</div>                <div>${correctTarget.text}</div>            `;            document.body.appendChild(div);            setTimeout(() => div.remove(), 2000);        }        function checkCollisions() {            bullets.forEach((bullet, bIndex) => {                targets.forEach(target => {                    if (!target.hit &&                        Math.sqrt((bullet.x - target.x)**2 + (bullet.y - target.y)**2) < target.size/2) {                        target.hit = true;                        bullets.splice(bIndex, 1);                        lastHitTarget = target;                        createExplosion(target.x, target.y, '#60A5FA', false);                        playSound('hit');                        if (!currentQuestionAnswered) {                            currentQuestionAnswered = true;                            setTimeout(processAnswer, 500);                        }                    }                });            });            if (!currentQuestionAnswered) {                targets.forEach(target => {                     if (!target.hit && target.y > canvas.height + target.size / 2) {                        if (target.isCorrect) {                           currentQuestionAnswered = true;                           combo = 0;                           // lives--; // REMOVED LIVES                           wrongAnswers.push({                               question: currentQuestionData.question,                               correct: currentQuestionData.correctAnswer,                               wrong: "未作答"                           });                           playSound('wrong');                           showCorrectAnswer();                           // updateUI(); // REMOVED UI UPDATE                           setTimeout(() => {                               currentQuestion++;                               loadQuestion();                           }, 2500);                        } else {                           target.hit = true;                        }                    }                });            }        }        function processAnswer() {            if (!lastHitTarget) return;            if (lastHitTarget.isCorrect) {                score += 10; correctCount++; combo++;                createExplosion(lastHitTarget.x, lastHitTarget.y, '#10B981', true);                playSound('correct');                showEncouragement(); // Called without x, y                if (combo > maxCombo) maxCombo = combo;                if (combo >= 2) {                    const div = document.createElement('div');                    div.className = 'combo-display';                    div.innerHTML = `${combo}<br><span style="font-size: 40px;">连击!</span>`;                    document.body.appendChild(div);                    setTimeout(() => div.remove(), 1000);                }            } else {                combo = 0;                // lives--; // REMOVED LIVES                createExplosion(lastHitTarget.x, lastHitTarget.y, '#EF4444', false);                playSound('wrong');                showCorrectAnswer();                wrongAnswers.push({                    question: currentQuestionData.question,                    correct: currentQuestionData.correctAnswer,                    wrong: lastHitTarget.text                });            }            // updateUI(); // REMOVED UI UPDATE            // No game over check based on lives            setTimeout(() => {                currentQuestion++;                loadQuestion();            }, lastHitTarget.isCorrect ? 1000 : 2500);        }        function gameLoop() {            ctx.clearRect(0, 0, canvas.width, canvas.height);            drawBackground();            if (gameState === 'playing') {                drawJ20();                drawTargets();                drawBullets();                updateParticles();                checkCollisions();                targets = targets.filter(t => !t.hit && t.y < canvas.height + t.size + 50);            }            requestAnimationFrame(gameLoop);        }        // --- Event Listeners ---        function handleMove(e) {            e.preventDefault();            let clientX, clientY;            if (e.touches) {                clientX = e.touches[0].clientX;                clientY = e.touches[0].clientY;                isDragging = true;            } else {                clientX = e.clientX;                clientY = e.clientY;            }            mouseX = clientX;            mouseY = clientY;            if (!isTouchDevice) {              crosshair.style.left = mouseX + 'px';              crosshair.style.top = mouseY + 'px';            }            if (gameState === 'playing') {                plane.targetX = mouseX;            }        }        function handleClick(e) {             e.preventDefault();             resumeAudio(); // Try to resume audio on ANY interaction in game             if (gameState === 'playing' && !currentQuestionAnswered) {                 let clickX, clickY;                 if (e.touches) {                    clickX = e.changedTouches[0].clientX;                    clickY = e.changedTouches[0].clientY;                    // Check if the tap is on the exit game button                    const exitBtnRect = exitGameBtn.getBoundingClientRect();                    if (clickX >= exitBtnRect.left && clickX <= exitBtnRect.right &&                        clickY >= exitBtnRect.top && clickY <= exitBtnRect.bottom) {                        // If it's on the exit button, let its onclick handle it                        return;                    }                    const currentTime = new Date().getTime();                    const tapLength = currentTime - lastTapTime;                    // Double tap for shooting on mobile                    // Only shoot if the tap is not on the exit button AND a double tap occurs                    if (tapLength < 300 && tapLength > 0 && bullets.length < 2) {                        shoot();                        lastTapTime = 0; // Reset to prevent triple tap                    } else {                        lastTapTime = currentTime;                    }                 } else {                    clickX = e.clientX;                    clickY = e.clientY;                 }                 let hit = false;                 // Only check for target hits on desktop (where cursor hits target)                 // For mobile, collision is handled by double-tap on plane.                 if (!isTouchDevice) {                     targets.forEach(target => {                         if (!target.hit && Math.sqrt((clickX - target.x)**2 + (clickY - target.y)**2) < target.size / 1.5) {                             target.hit = true;                             lastHitTarget = target;                             createExplosion(target.x, target.y, '#60A5FA', false);                             playSound('hit');                             if (!currentQuestionAnswered) {                                 currentQuestionAnswered = true;                                 setTimeout(processAnswer, 500);                             }                             hit = true;                         }                     });                 }                 // If on desktop and no target was hit directly, shoot                 if (!hit && !isTouchDevice && bullets.length < 2) {                     shoot(); // Call shoot without arguments                 }             }        }         document.addEventListener('mousemove', handleMove);         canvas.addEventListener('mousedown', handleClick);         canvas.addEventListener('touchstart', handleMove, { passive: false }); // Use passive: false if preventing default         canvas.addEventListener('touchmove', handleMove, { passive: false });         canvas.addEventListener('touchend', (e) => {             isDragging = false;             handleClick(e); // Process tap/double-tap logic here         });        function startGame() {            initAudio(); // Initialize audio context            resumeAudio(); // Attempt to resume it right away            gameState = 'playing';            score = 0; currentQuestion = 0; combo = 0;            maxCombo = 0; correctCount = 0; wrongAnswers = [];            targets = []; bullets = []; particles = [];            questions = [...questionBank].sort(() => Math.random() - 0.5).slice(0, 10);            document.getElementById('startScreen').style.display = 'none';            document.getElementById('endScreen').style.display = 'none';            document.getElementById('gameUI').style.display = 'block';            if (isTouchDevice) {                exitGameBtn.style.display = 'block';                mobileShootInstructionStart.style.display = 'none'; // Hide start instruction during game            } else {                exitGameBtn.style.display = 'none';                mobileShootInstructionStart.style.display = 'none'; // Hide instruction on desktop            }            loadQuestion();        }        function loadQuestion() {            // Only check currentQuestion vs 10, no lives check            if (currentQuestion < 10) {                currentQuestionData = questions[currentQuestion];                document.getElementById('question').textContent = `${currentQuestion + 1}. ${currentQuestionData.question}`;                createTargets();                // updateUI(); // REMOVED                currentQuestionAnswered = false;                lastHitTarget = null;            } else {                endGame();            }        }        // updateUI function is removed as stats are hidden        function endGame() {            gameState = 'ended';            document.getElementById('gameUI').style.display = 'none';            document.getElementById('endScreen').style.display = 'flex';            document.getElementById('finalScore').textContent = score;            document.getElementById('accuracy').textContent = Math.round((correctCount / 10) * 100);            document.getElementById('maxCombo').textContent = maxCombo;            let grade = '';            // Grade calculation no longer considers lives            if (score >= 90 && correctCount === 10) grade = '🏆 完美通关！历史学霸！';            else if (score >= 90) grade = '🌟 历史学霸！';            else if (score >= 80) grade = '⭐ 优秀！';            else if (score >= 70) grade = '👍 良好！';            else if (score >= 60) grade = '✅ 及格！';            else grade = '💪 继续努力！';            document.getElementById('gradeDisplay').textContent = grade;            const wrongDiv = document.getElementById('wrongAnswers');            if (wrongAnswers.length > 0) {                let html = '<h3 style="color: #FFD700; margin-bottom: 15px; font-size: 18px;">📚 错题回顾：</h3>';                wrongAnswers.forEach((item, index) => {                    html += `<div class="wrong-item">                        <div style="font-weight: bold; margin-bottom: 5px;">                           ${item.question}                        </div>                        <div style="margin-left: 15px;">                            <div style="color: #10B981; margin-bottom: 3px;">✅ 正确: ${item.correct}</div>                            <div style="color: #EF4444;">❌ 你的: ${item.wrong}</div>                        </div>                    </div>`;                });                wrongDiv.innerHTML = html;            } else {                wrongDiv.innerHTML = '<p style="color: #10B981; font-size: 22px; text-align: center; margin-top: 20px;">🎉 太棒了！全部答对！</p>';            }        }        function restartGame() {            document.getElementById('endScreen').style.display = 'none';            startGame();        }        function exitGame() {            gameState = 'menu';            document.getElementById('gameUI').style.display = 'none';            document.getElementById('startScreen').style.display = 'flex';            // Clear any ongoing game elements if necessary            targets = [];            bullets = [];            particles = [];            currentQuestionData = null;            // Ensure mobile-specific elements are hidden/shown correctly on exit            if (isTouchDevice) {                mobileShootInstructionStart.style.display = 'block'; // Show on start screen            } else {                mobileShootInstructionStart.style.display = 'none'; // Ensure hidden on desktop            }        }        // --- Initialization ---        resizeCanvas();        createNebulae();        gameLoop();        // Initial setup for touch device UI elements        if (isTouchDevice) {            document.body.style.cursor = 'auto'; // Show default cursor for touch            document.getElementById('crosshair').style.display = 'none'; // Hide crosshair            mobileShootInstructionStart.style.display = 'block'; // Show on start screen initially        } else {            document.body.style.cursor = 'none'; // Hide cursor for desktop            document.getElementById('crosshair').style.display = 'block'; // Show crosshair            mobileShootInstructionStart.style.display = 'none'; // Hide on desktop        }         // Add event listener for touch start anywhere to try and unlock audio        document.body.addEventListener('touchstart', resumeAudio, { once: true });        // Also add click listener for general interaction on desktop to resume audio        document.body.addEventListener('click', resumeAudio, { once: true });    </script></body></html>```